# IRO/GLA API

本文档提供首次 RWA 发行（IRO）系统的 API 文档，也称为创世启动拍卖（GLA）。IRO 实现代币化真实世界资产的无许可发行和认购。

## 概览

IRO 系统由两个主要合约组成：
- **GLA（GenesisLaunchAuction）**：处理初始代币分配阶段
- **Market**：启用 RWA 代币的二级交易

---

## 合约地址（BSC 主网）

| 合约 | 地址 |
|----------|---------|
| WeUSD | `0xdd73EA766B80417C0607A3f08E34A0C415D89D56` |
| RWALaunchpad | `0x29Ef43797B278F3abD0C5A4D9E3CA21649889834` |

---

## GLA（创世启动拍卖）

### 购买函数

#### whitelistBuy

允许白名单用户在白名单阶段以优惠价格购买 RWA 代币。

```solidity
function whitelistBuy(uint256 amount) external
```

**参数：**
- `amount`：要花费的 WeUSD 金额

**要求：**
- 必须在白名单阶段
- 调用者必须在白名单中
- WeUSD 必须授权给合约

#### publicOfferingBuy

允许任何用户在公开发行阶段购买 RWA 代币。

```solidity
function publicOfferingBuy(uint256 amount) external
```

**参数：**
- `amount`：要花费的 WeUSD 金额

**要求：**
- 必须在公开发行阶段
- WeUSD 必须授权给合约

### 领取和提款函数

#### claim

在市场初始化后领取购买的 RWA 代币。

```solidity
function claim() external
```

**要求：**
- 市场必须已初始化（`initialized = true`）
- 用户必须有未领取的份额

#### withdraw

如果未达到软顶且解锁阶段已开始，则提取存入的 WeUSD。

```solidity
function withdraw() external
```

**要求：**
- 必须未达到软顶
- 必须在解锁阶段
- 用户必须有未领取的份额

---

## IRO 生命周期

```
┌─────────────────────────────────────────────────────────────────┐
│                        IRO 生命周期                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 白名单阶段                                                   │
│     ├─ 白名单用户可以以优惠价格购买                                │
│     └─ 持续时间：由发行人配置                                     │
│                                                                 │
│  2. 公开发行阶段                                                  │
│     ├─ 对所有参与者开放                                          │
│     └─ 适用标准定价                                              │
│                                                                 │
│  3. 结算                                                         │
│     ├─ 如果达到软顶 → 市场初始化                                  │
│     └─ 如果未达到软顶 → 解锁阶段开始                              │
│                                                                 │
│  4a. 领取（成功）                                                 │
│      └─ 用户领取 RWA 代币                                        │
│                                                                 │
│  4b. 提款（失败）                                                 │
│      └─ 用户提取存入的 WeUSD                                     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 查询函数

### 获取用户份额

```typescript
const shares = await gla.getUserShares(userAddress);
console.log(`用户份额: ${ethers.formatUnits(shares, 18)}`);
```

### 获取当前阶段

```typescript
const phase = await gla.getPhase();
// 0 = 未开始
// 1 = 白名单阶段
// 2 = 公开发行
// 3 = 已结束
// 4 = 解锁（如果未达到软顶）
```

### 获取募资进度

```typescript
const softCap = await gla.getSoftCap();
const hardCap = await gla.getHardCap();
const totalRaised = await gla.getTotalRaised();

const progressPercent = (Number(totalRaised) / Number(softCap)) * 100;
console.log(`进度: ${progressPercent.toFixed(2)}%`);
```

---

## 重要说明

### 代币精度

| 代币 | 精度 |
|-------|----------|
| WeUSD | 6 |
| RWA Token | 18 |
| prRWA（预售）| 18 |

### 授权要求

所有购买操作都需要事先将 WeUSD 授权给 GLA 合约：

```typescript
// 购买前始终检查并设置足够的额度
const allowance = await weusd.allowance(userAddress, glaAddress);
if (allowance < purchaseAmount) {
  await weusd.approve(glaAddress, purchaseAmount);
}
```

